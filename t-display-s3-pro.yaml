substitutions:
  doorbell_user: !secret doorbell_user
  doorbell_password: !secret doorbell_password

esphome:
  name: t-display-s3-pro
  friendly_name: T-Display S3 Pro

psram:
  mode: octal

esp32:
  board: esp32-s3-devkitc-1
  framework:
    type: arduino

logger:
api:
ota:
  - platform: esphome

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  on_connect:
    - component.update: doorbell_image

output:
  - platform: ledc
    pin: GPIO48
    id: backlight_pwm

light:
  - platform: monochromatic
    output: backlight_pwm
    name: "T-Display Backlight"
    restore_mode: ALWAYS_ON

spi:
  - id: spi_bus
    clk_pin: 18
    mosi_pin: 17

http_request:
  useragent: esphome
  verify_ssl: false
  timeout: 10s

online_image:
  - id: doorbell_image
    url: "http://192.168.50.128/cgi-bin/api.cgi?cmd=Snap&channel=0&rs=esphome&user=${doorbell_user}&password=${doorbell_password}&snapType=sub&width=480&height=640"
    format: jpeg
    type: RGB565
    resize: 222x296
    request_headers:
      Accept: "image/jpeg"
      Connection: "close"
    update_interval: 10s
    on_download_finished:
      - component.update: my_display

# Final working doorbell camera display
display:
  - platform: mipi_spi
    model: t-display-s3-pro
    spi_id: spi_bus
    rotation: 0
    id: my_display
    update_interval: 500ms
    lambda: |-
      it.fill(Color::BLACK);
      it.image(0, 0, id(doorbell_image));

# Snapshot fetch handled by online_image component

font:
  - file: "gfonts://Roboto"
    id: arial
    size: 16